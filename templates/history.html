<!DOCTYPE html>
<html>
<head>
  <title>Purchase History</title>
  <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
  <div class="header">
    <h1>All-Time Purchase History</h1>
    <nav>
      <a class="btn-nav" href="{{ url_for('home') }}">Home</a>
      <a class="btn-nav" href="{{ url_for('history') }}">History</a>
      <a class="btn-nav" href="{{ url_for('financial') }}">Financial Data</a>
      <a class="btn-signout" href="{{ url_for('logout') }}">Sign Out</a>
    </nav>
  </div>

 <form method="post" action="{{ url_for('history') }}" class="add-form">
  <input type="text" name="new_item" placeholder="Enter item name (e.g. Banana)" required>
  <button type="submit" name="add_item">Add Item</button>
</form>

{% if error and override_item %}
  <!-- duplicate warning + override form -->
  <form method="post" action="{{ url_for('history') }}" class="error-override">
    <p>{{ error|safe }} Choose another name, or:</p>
    <!-- carry over the item and flag -->
    <input type="hidden" name="new_item" value="{{ override_item }}">
    <input type="hidden" name="force_add" value="1">
    <button type="submit" name="add_item">Add Anyway</button>
    <button type="submit">Cancel</button>
  </form>
{% elif error %}
  <!-- regular errors -->
  <div class="error">{{ error|safe }}</div>
{% endif %}

  {% if purchases %}
  <form method="post" action="{{ url_for('history') }}">
    <table>
      <thead>
        <tr>
          <th></th>
          <th>Date</th>
          <th>Item</th>
          <th>Price</th>
          <th>Category</th>
          <th>Subcategory</th>
        </tr>
      </thead>
      <tbody>
      {% for id, name, price, category, subcat, date in purchases %}
        <tr>
          <td>
            <input type="checkbox" name="selected" value="{{ id }}">
          </td>
          <td>{{ date }}</td>
          <td>{{ name }}</td>
          <td>${{ "%.2f"|format(price) }}</td>
          <td>{{ category }}</td>
          <td>{{ subcat }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>

    <div class="actions">
      <button type="submit" name="delete_selected">Delete Selected</button>
      <button type="submit" name="clear_all" onclick="return confirm('Are you sure your want to clear your purchase history?');">
        Clear All
      </button>
    </div>
  </form>
  {% else %}
    <p>No purchases found.</p>
  {% endif %}
</body>
</html>
